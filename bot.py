import telebot
from datetime import date, datetime
from dateutil.relativedelta import relativedelta
from PIL import Image, ImageDraw, ImageFont
import os
import json
from flask import Flask, request
from telebot import types
from apscheduler.schedulers.background import BackgroundScheduler
import random

# ---------- –ù–ê–°–¢–†–û–ô–ö–ò ----------
BOT_TOKEN = "8312401636:AAGfQXDN5v5in2d4jUHMZZdTJYt29TfF3I8"
DATA_FILE = "users.json"
bot = telebot.TeleBot(BOT_TOKEN, threaded=False)

# ---------- –°–ü–ò–°–û–ö –¶–ò–¢–ê–¢ ----------
quotes = [
    # --- –û –∂–∏–∑–Ω–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ ---
    "–ù–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —Ü–µ–ø–æ—á–∫–∞ –¥–Ω–µ–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è.",
    "–í—Ä–µ–º—è –Ω–µ –∂–¥—ë—Ç, –Ω–æ –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç —Ä—è–¥–æ–º.",
    "–ö–∞–∂–¥–∞—è –Ω–µ–¥–µ–ª—è ‚Äî –µ—â—ë –æ–¥–∏–Ω —à—Ç—Ä–∏—Ö —Ç–≤–æ–µ–π –∏—Å—Ç–æ—Ä–∏–∏.",
    "–ù–µ –ø—ã—Ç–∞–π—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è ‚Äî –Ω–∞–ø–æ–ª–Ω–∏ –µ–≥–æ —Å–º—ã—Å–ª–æ–º.",
    "–ñ–∏–∑–Ω—å –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –Ω–µ –≥–æ–¥–∞–º–∏, –∞ –º–æ–º–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å –º–µ–Ω—è—é—Ç.",
    "–°–µ–≥–æ–¥–Ω—è ‚Äî –Ω–∞—á–∞–ª–æ –æ—Å—Ç–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏.",
    "–ü—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è —É–∂–µ –∏—Å—Ç–æ—Ä–∏—è. –ù–æ–≤–∞—è ‚Äî –≤ —Ç–≤–æ–∏—Ö —Ä—É–∫–∞—Ö.",
    "–°–µ–∫—É–Ω–¥—ã –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –≥–æ–¥—ã ‚Äî –Ω–µ —É–ø—É—Å—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–∏–µ.",
    "–ò–Ω–æ–≥–¥–∞ –≤—Ä–µ–º—è –ª–µ—Ç–∏—Ç, –∏–Ω–æ–≥–¥–∞ —Ç—è–Ω–µ—Ç—Å—è, –Ω–æ –æ–Ω–æ –≤—Å–µ–≥–¥–∞ —Ç–≤–æ—ë.",
    "–ü–æ–∫–∞ —Ç—ã —á–∏—Ç–∞–µ—à—å —ç—Ç–æ, —Ç—ã —É–∂–µ –ø—Ä–æ–∂–∏–ª –µ—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.",
    "–í—Å—ë –ø—Ä–æ–π–¥—ë—Ç ‚Äî –∏ —ç—Ç–æ —Ç–æ–∂–µ.",
    "–ú—ã –Ω–µ –∑–∞–º–µ—á–∞–µ–º, –∫–∞–∫ –¥–Ω–∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ –∂–∏–∑–Ω—å.",
    "–ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ ‚Äî —à–∞–Ω—Å –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.",
    "–¢–∏—à–∏–Ω–∞ —Ç–æ–∂–µ —Ç–µ—á—ë—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–∏.",
    "–ù–∏–∫—Ç–æ –Ω–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç, —á—Ç–æ ¬´–ø–æ—Ç–æ–º¬ª –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ.",
    "–°–∞–º–æ–µ –±—ã—Å—Ç—Ä–æ–µ –Ω–∞ —Å–≤–µ—Ç–µ ‚Äî –≥–æ–¥—ã.",
    "–î–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚Äî –∏–¥—ë—Ç –∂–∏–∑–Ω—å.",
    "–í—á–µ—Ä–∞—à–Ω–∏–µ —Ç—Ä–µ–≤–æ–≥–∏ —É–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—á–∞—Ç.",
    "–ë—É–¥—É—â–µ–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–∏—Ö–æ, —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ —á–∏—Å—Ç—ã–π –ª–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –º—ã —á–∞—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–µ—à–∫–æ–π.",

    # --- –¢—ë–ø–ª—ã–µ –∏ –º—è–≥–∫–∏–µ ---
    "–°–µ–≥–æ–¥–Ω—è ‚Äî –Ω–µ–ø–ª–æ—Ö–æ–π –¥–µ–Ω—å, —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –±—ã—Ç—å.",
    "–ù–µ –≤—Å—ë –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ–±—ã —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å.",
    "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç—è—Ç, —á—Ç–æ–±—ã —Ç—ã –æ—Ç–¥–æ—Ö–Ω—É–ª.",
    "–ñ–∏–∑–Ω—å ‚Äî –Ω–µ –≥–æ–Ω–∫–∞, –∞ –ø—Ä–æ–≥—É–ª–∫–∞ —Å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –º–∞—Ä—à—Ä—É—Ç–æ–º.",
    "–ò–Ω–æ–≥–¥–∞ —Å—á–∞—Å—Ç—å–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –≤–∏–¥–µ —Ç–∏—à–∏–Ω—ã –∏ —á–∞—à–∫–∏ —á–∞—è.",
    "–ë—É–¥—å —Ç–∞–º, –≥–¥–µ —Ç–µ–±–µ —Å–ø–æ–∫–æ–π–Ω–æ.",
    "–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ–µ, —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å ‚Äî –ø—Ä–æ—Å—Ç–æ –¥—ã—à–∞—Ç—å.",
    "–ú–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–∏—à–µ, –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—à—å —Å–ª—É—à–∞—Ç—å.",
    "–ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∂–∏—Ç—å ‚Äî –∏ –≤ —ç—Ç–æ–º –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–∞.",
    "–î–∞–∂–µ –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –≤–∞–∂–Ω—ã–º, –µ—Å–ª–∏ –µ–≥–æ –∑–∞–º–µ—Ç–∏—Ç—å.",

    # --- –ù–æ—Å—Ç–∞–ª—å–≥–∏—è –∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è ---
    "–ò–Ω–æ–≥–¥–∞ —Ü–µ–ª–∞—è –∂–∏–∑–Ω—å —É–º–µ—â–∞–µ—Ç—Å—è –≤ –æ–¥–Ω–æ –ª–µ—Ç–æ.",
    "–î–µ—Ç—Å—Ç–≤–æ –Ω–µ —É—Ö–æ–¥–∏—Ç ‚Äî –æ–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º.",
    "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–º–µ–Ω—Ç—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—Å—è, –∏ –≤ —ç—Ç–æ–º –∏—Ö –∫—Ä–∞—Å–æ—Ç–∞.",
    "–ú—ã –≤–∑—Ä–æ—Å–ª–µ–µ–º –≤ —Ç–æ—Ç –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å–∫—É—á–∞—Ç—å –ø–æ —Å–µ–±–µ –ø—Ä–æ—à–ª–æ–º—É.",
    "–ü—Ä–æ—à–ª–æ–µ –∂–∏–≤—ë—Ç –≤ –∑–∞–ø–∞—Ö–∞—Ö –∏ –ø–µ—Å–Ω—è—Ö.",
    "–ò–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–µ –≤–æ –≤—Ä–µ–º—è, –∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.",
    "–ü–∞–º—è—Ç—å ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–µ—Ä–¥—Ü–∞ —Å–∫–∞–∑–∞—Ç—å: ¬´—è –≤—Å—ë –µ—â—ë —á—É–≤—Å—Ç–≤—É—é¬ª.",
    "–ì–æ–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –∞ –æ—â—É—â–µ–Ω–∏–µ —é–Ω–æ—Å—Ç–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –≥–¥–µ-—Ç–æ —Ä—è–¥–æ–º.",
    "–ò–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ –ø–æ–±—ã—Ç—å —Ç–µ–º, –∫–µ–º –±—ã–ª —Ä–∞–Ω—å—à–µ.",
    "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Å—Ç–∞ –Ω–∞–≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –Ω–∞—Å.",

    # --- –°–ø–æ–∫–æ–π–Ω–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è ---
    "–ù–µ –±–æ–π—Å—è –∏–¥—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω–æ, –±–æ–π—Å—è —Å—Ç–æ—è—Ç—å.",
    "–ù–∞—Å—Ç–æ—è—â–µ–µ ‚Äî —ç—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–∏–µ –º–µ–∂–¥—É —É–∂–µ –∏ –µ—â—ë.",
    "–ú—ã –Ω–µ —Ç–µ—Ä—è–µ–º –≥–æ–¥—ã ‚Äî –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —á–∞—Å—Ç—å—é –Ω–∞—Å.",
    "–ü–æ–∫–∞ –º—ã —Å—á–∏—Ç–∞–µ–º –Ω–µ–¥–µ–ª–∏, –∂–∏–∑–Ω—å —Å—á–∏—Ç–∞–µ—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è.",
    "–í—Ä–µ–º—è ‚Äî –ª—É—á—à–∏–π —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫, –Ω–æ —É–∂–∞—Å–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫.",
    "–ù–µ –≤—Å–µ –ø—É—Ç–∏ –¥–æ–ª–∂–Ω—ã –∫—É–¥–∞-—Ç–æ –≤–µ—Å—Ç–∏.",
    "–ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –±—ã—Ç—å ‚Äî –∏ —ç—Ç–æ–≥–æ —É–∂–µ –º–Ω–æ–≥–æ.",
    "–¢–æ—Ç, –∫—Ç–æ —É–º–µ–µ—Ç –∂–¥–∞—Ç—å, –∂–∏–≤—ë—Ç –≤ —Ä–∏—Ç–º–µ –≤—Ä–µ–º–µ–Ω–∏.",
    "–°–º—ã—Å–ª —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ ‚Äî –∫–æ–≥–¥–∞ —É–∂–µ –Ω–µ –∏—â–µ—à—å.",
    "–ü—Ä–æ–∂–∏—Ç—å –¥–µ–Ω—å ‚Äî —É–∂–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ.",

    # --- –û –±—ã—Å—Ç—Ä–æ—Ç–µ—á–Ω–æ—Å—Ç–∏ ---
    "–ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å, –∏ –≤ —ç—Ç–æ–º –≤—Å—è –º–∞–≥–∏—è.",
    "–ü–æ–∫–∞ –º—ã —Å—Ç—Ä–æ–∏–º –ø–ª–∞–Ω—ã, –≤—Ä–µ–º—è —É–ª—ã–±–∞–µ—Ç—Å—è –∏ –∏–¥—ë—Ç –¥–∞–ª—å—à–µ.",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤—á–µ—Ä–∞ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
    "–ì–æ–¥—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚Äî –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è—é—Ç –Ω–∞—Å.",
    "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–≥–Ω–æ–≤–µ–Ω–∏—è –¥–ª—è—Ç—Å—è –¥–æ–ª—å—à–µ, —á–µ–º —Ü–µ–ª—ã–π –≥–æ–¥.",
    "–ß–µ–º –¥–æ–ª—å—à–µ –∂–∏–≤—ë—à—å, —Ç–µ–º –∫–æ—Ä–æ—á–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≥–æ–¥—ã.",
    "–°–µ–∫—É–Ω–¥—ã –Ω–µ–∑–∞–º–µ—Ç–Ω—ã, –ø–æ–∫–∞ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏.",
    "–ú—ã –Ω–µ –∑–∞–º–µ—á–∞–µ–º, –∫–∞–∫ –ø—Ä–æ–∂–∏–≤–∞–µ–º –º–µ—á—Ç—ã.",
    "–ò–Ω–æ–≥–¥–∞ –∂–∏–∑–Ω—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–º–µ—Ç–Ω–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –º–µ–∂–¥—É –≤—Å—Ç—Ä–µ—á–∞–º–∏ –∏ —Å–Ω–∞–º–∏.",
    "–ñ–∏–∑–Ω—å —Ç–µ—á—ë—Ç —Ç–∏—Ö–æ, –µ—Å–ª–∏ –Ω–µ —Å–ø–µ—à–∏—Ç—å.",

    # --- –ù–µ–º–Ω–æ–≥–æ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ ---
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —à–∞–Ω—Å —Å–¥–µ–ª–∞—Ç—å —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ –ø–æ-–¥—Ä—É–≥–æ–º—É.",
    "–°–µ–≥–æ–¥–Ω—è –º–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å –Ω—É–ª—è, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.",
    "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî —É—Å–ø–µ–µ—à—å. –ü—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏.",
    "–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É—Å–ø–µ–≤–∞—Ç—å –≤—Å—ë. –ì–ª–∞–≤–Ω–æ–µ ‚Äî —É—Å–ø–µ—Ç—å –ø–æ–∂–∏—Ç—å.",
    "–ü—É—Å—Ç—å —Ç–≤–æ–π –¥–µ–Ω—å –±—É–¥–µ—Ç –¥–æ–±—Ä—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–º–µ—Ç–∏—Ç.",
    "–°—á–∞—Å—Ç—å–µ –Ω–µ –≥—Ä–æ–º–∫–æ–µ. –û–Ω–æ –ø—Ä–æ—Å—Ç–æ –µ—Å—Ç—å.",
    "–ñ–∏–≤–∏ –Ω–µ —Å–ø–µ—à–∞, –Ω–æ –Ω–µ —Å—Ç–æ–π –Ω–∞ –º–µ—Å—Ç–µ.",
    "–ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Å–¥–∞–≤–∞—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è.",
    "–ù–µ –≤—Å—ë –ø–æ—Ç–µ—Ä—è–Ω–æ, –ø–æ–∫–∞ —Ç—ã –≤—Å—ë –µ—â—ë —Ö–æ—á–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å.",
    "–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–Ω–∞—Ç—å –ø—É—Ç—å, —á—Ç–æ–±—ã –ø–æ –Ω–µ–º—É –∏–¥—Ç–∏.",

    # --- –ü—Ä–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ ---
    "–°–µ–≥–æ–¥–Ω—è ‚Äî —Ç–æ –∑–∞–≤—Ç—Ä–∞, –æ –∫–æ—Ç–æ—Ä–æ–º —Ç—ã –¥—É–º–∞–ª –≤—á–µ—Ä–∞.",
    "–ù–∞—Å—Ç–æ—è—â–µ–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–º–µ—Ç–Ω–æ.",
    "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ –æ–∫–Ω–æ –∏ –≤—Å–ø–æ–º–Ω–∏, —á—Ç–æ –≤—Å—ë –µ—â—ë –∑–¥–µ—Å—å.",
    "–ú—ã —Ç–∞–∫ –º–Ω–æ–≥–æ –¥—É–º–∞–µ–º –æ –±—É–¥—É—â–µ–º, —á—Ç–æ –∑–∞–±—ã–≤–∞–µ–º –¥—ã—à–∞—Ç—å –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º.",
    "–ò–Ω–æ–≥–¥–∞ –¥–µ–Ω—å –∫–∞–∂–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º, –ø–æ–∫–∞ –Ω–µ —Å—Ç–∞–Ω–µ—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º.",
    "–°–µ–π—á–∞—Å ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —Ç–≤–æ—ë.",
    "–ü–æ—á—É–≤—Å—Ç–≤—É–π, –∫–∞–∫ –∂–∏–≤—ë—Ç –º–æ–º–µ–Ω—Ç.",
    "–í—Å—ë, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–µ–≥–æ–¥–Ω—è.",
    "–ù–µ –∏—â–∏ –æ—Å–æ–±–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π ‚Äî —Å–¥–µ–ª–∞–π —ç—Ç–æ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–º.",
    "–ò–Ω–æ–≥–¥–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–æ–∏—Ç –±–æ–ª—å—à–µ, —á–µ–º –≥–æ–¥ –æ–∂–∏–¥–∞–Ω–∏—è.",

    # --- –õ—ë–≥–∫–∞—è –≥—Ä—É—Å—Ç—å –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ ---
    "–í—Å—ë –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–µ –≤—Å—ë –∑–∞–±—ã–≤–∞–µ—Ç—Å—è.",
    "–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –Ω–∞–π—Ç–∏ —Å–µ–±—è.",
    "–ë–æ–ª—å —Ç–æ–∂–µ —á–∞—Å—Ç—å –ø—É—Ç–∏.",
    "–ú—ã –Ω–µ –º–æ–∂–µ–º –≤–µ—Ä–Ω—É—Ç—å –≤—Ä–µ–º—è, –Ω–æ –º–æ–∂–µ–º –≤–µ—Ä–Ω—É—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ.",
    "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—â–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã —Ç–æ–ª—å–∫–æ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ª–µ—Ç.",
    "–ò–Ω–æ–≥–¥–∞ –º–æ–ª—á–∞–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –±–æ–ª—å—à–µ —Å–ª–æ–≤.",
    "–° –∫–∞–∂–¥—ã–º –≥–æ–¥–æ–º –ª–µ–≥—á–µ –ø—Ä–æ—â–∞—Ç—å, –Ω–æ —Ç—Ä—É–¥–Ω–µ–µ –∑–∞–±—ã–≤–∞—Ç—å.",
    "–ñ–∏–∑–Ω—å –Ω–µ –æ–±—è–∑–∞–Ω–∞ –±—ã—Ç—å –ª—ë–≥–∫–æ–π, —á—Ç–æ–±—ã –±—ã—Ç—å –∫—Ä–∞—Å–∏–≤–æ–π.",
    "–î–∞–∂–µ –∫–æ–≥–¥–∞ –≥—Ä—É—Å—Ç–Ω–æ ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –∂–∏–∑–Ω—å.",
    "–í—Ä–µ–º—è –Ω–µ –ª–µ—á–∏—Ç, –Ω–æ –¥–µ–ª–∞–µ—Ç –±–æ–ª—å –º—è–≥—á–µ.",

    # --- –û –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –∏ —Ç–µ–ø–ª–µ ---
    "–ë–ª–∞–≥–æ–¥–∞—Ä–∏ –∑–∞ —Ç–æ, —á—Ç–æ –±—ã–ª–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–æ —Å–ª–æ–∂–Ω–æ.",
    "–ò–Ω–æ–≥–¥–∞ —Å—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—Å–æ–∑–Ω–∞—Ç—å, —á—Ç–æ –≤—Å—ë –µ—â—ë –µ—Å—Ç—å —Å–∏–ª—ã.",
    "–ö–∞–∂–¥—ã–π –ø—Ä–æ–∂–∏—Ç—ã–π –¥–µ–Ω—å ‚Äî —É–∂–µ –ø–æ–¥–∞—Ä–æ–∫.",
    "–ó–∞–º–µ—Ç—å —Ö–æ—Ä–æ—à–µ–µ, –ø–æ–∫–∞ –æ–Ω–æ —Ä—è–¥–æ–º.",
    "–î–∞–∂–µ –µ—Å–ª–∏ –¥–µ–Ω—å –±—ã–ª —Ç—è–∂—ë–ª—ã–º ‚Äî –æ–Ω –±—ã–ª —Ç–≤–æ–∏–º.",
    "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏ –≤—Ä–µ–º—è –∑–∞ —Ç–æ, —á—Ç–æ –æ–Ω–æ –∏–¥—ë—Ç.",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –¥–µ–ª–∞–µ—Ç –º–∏–Ω—É—Ç—ã –¥–æ–ª—å—à–µ.",
    "–í—Å—ë —Ü–µ–Ω–Ω–æ–µ –æ–±—ã—á–Ω–æ —Ç–∏—Ö–æ–µ.",
    "–ù–µ —Å–ø–µ—à–∏. –•–æ—Ä–æ—à–µ–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç.",
    "–ú–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–µ–ø–ª–µ–µ, –∫–æ–≥–¥–∞ —Ç—ã –µ–≥–æ –∑–∞–º–µ—á–∞–µ—à—å.",

    # --- –û —Å–º—ã—Å–ª–µ –∏ –ø—Ä–æ—Å—Ç–æ—Ç–µ ---
    "–°–º—ã—Å–ª –Ω–µ –∏—â—É—Ç ‚Äî –µ–≥–æ —á—É–≤—Å—Ç–≤—É—é—Ç.",
    "–ò–Ω–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å.",
    "–ü—Ä–æ—Å—Ç—ã–µ –≤–µ—â–∏ —Å–ø–∞—Å–∞—é—Ç —á–∞—â–µ, —á–µ–º –≤–µ–ª–∏–∫–∏–µ.",
    "–ò–Ω–æ–≥–¥–∞ –≤—Å—ë —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ‚Äî —É–∂–µ —Ä—è–¥–æ–º.",
    "–°–ª–æ–∂–Ω–æ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞—ë—à—å –±–æ—è—Ç—å—Å—è.",
    "–ù–µ –≤—Å—ë –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ–±—ã —Ü–µ–Ω–∏—Ç—å.",
    "–ò–Ω–æ–≥–¥–∞ —Ç–∏—à–∏–Ω–∞ ‚Äî —Å–∞–º—ã–π —á–µ—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç.",
    "–ü–æ–∫–æ–π –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑–≤–Ω–µ ‚Äî –æ–Ω —Ä–∞—Å—Ç—ë—Ç –≤–Ω—É—Ç—Ä–∏.",
    "–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ, –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å, –∑–∞—á–µ–º ‚Äî –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ –∂–∏–≤—ë—à—å.",
    "–ñ–∏–∑–Ω—å –Ω–µ –∑–∞–≥–∞–¥–∫–∞, –∞ –ø—Ä–æ—Ü–µ—Å—Å.",

    # --- –ö–æ—Ä–æ—Ç–∫–∏–µ, –∫–∞–∫ –¥—ã—Ö–∞–Ω–∏–µ ---
    "–í—Å—ë –±—É–¥–µ—Ç. –ù–æ –Ω–µ –≤—Å—ë —Å—Ä–∞–∑—É.",
    "–ü—Ä–æ—Å—Ç–æ –∂–∏–≤–∏.",
    "–¢–∏—à–µ ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –æ—Ç–≤–µ—Ç.",
    "–ì–ª–∞–≤–Ω–æ–µ ‚Äî –±—ã—Ç—å.",
    "–ù–µ —Å–ø–µ—à–∏. –£—Å–ø–µ–µ—à—å.",
    "–í–¥–æ—Ö. –í—ã–¥–æ—Ö. –î–µ–Ω—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.",
    "–ü—É—Å—Ç—å –±—É–¥–µ—Ç –∫–∞–∫ –±—É–¥–µ—Ç.",
    "–ñ–∏–≤–∏ –º—è–≥–∫–æ.",
    "–ö–∞–∂–¥–æ–µ ¬´—Å–µ–≥–æ–¥–Ω—è¬ª –∫–æ–≥–¥–∞-—Ç–æ —Å—Ç–∞–Ω–µ—Ç ¬´–≤—á–µ—Ä–∞¬ª.",
    "–ò–¥–∏. –ü—Ä–æ—Å—Ç–æ –∏–¥–∏.",
]

# ---------- –ó–ê–ì–†–£–ó–ö–ê / –°–û–•–†–ê–ù–ï–ù–ò–ï ----------
def load_users():
    if os.path.exists(DATA_FILE):
        with open(DATA_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    return {}

def save_users(data):
    with open(DATA_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

users = load_users()
awaiting_birth_date_change = set()  # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç –¥–∞—Ç—É

# ---------- –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–¢–ò–ù–ö–ò ----------
def generate_life_weeks_image(birth_date, current_date, life_expectancy_years=80):
    end_of_life = birth_date + relativedelta(years=life_expectancy_years)
    delta = relativedelta(end_of_life, current_date)
    remaining_days_total = (end_of_life - current_date).days
    lived_weeks = (current_date - birth_date).days // 7
    total_weeks = life_expectancy_years * 52

    cols = 52
    rows = life_expectancy_years
    size = 10
    margin = 2
    left_space = 35
    top_space = 90

    img_width = cols * (size + margin) + margin + left_space + 20
    img_height = rows * (size + margin) + margin + top_space + 20
    img = Image.new("RGB", (img_width, img_height), "white")
    draw = ImageDraw.Draw(img)

    try:
        font = ImageFont.truetype("/usr/share/fonts/truetype/noto/NotoSans-Regular.ttf", 14)
        title_font = ImageFont.truetype("/usr/share/fonts/truetype/noto/NotoSans-Regular.ttf", 18)
    except:
        font = ImageFont.load_default()
        title_font = ImageFont.load_default()

    draw.text((10, 10), f"–ü—Ä–æ–∂–∏—Ç–æ: {lived_weeks} –Ω–µ–¥–µ–ª—å", fill="black", font=title_font)
    draw.text((10, 40), f"–û—Å—Ç–∞–ª–æ—Å—å: {total_weeks - lived_weeks} –Ω–µ–¥–µ–ª—å ({remaining_days_total} –¥–Ω–µ–π)", fill="gray", font=font)

    for w in range(4, cols + 1, 4):
        x_pos = left_space + (w - 1) * (size + margin)
        draw.text((x_pos, top_space - 18), str(w), fill="gray", font=font)

    for y in range(rows):
        y_pos = top_space + y * (size + margin) - 2
        draw.text((10, y_pos), str(y + 1), fill="gray", font=font)

    for i in range(total_weeks):
        x = left_space + (i % cols) * (size + margin)
        y = top_space + (i // cols) * (size + margin)
        color = (220, 20, 60) if i < lived_weeks else (230, 230, 230)
        draw.rectangle([x, y, x + size, y + size], fill=color)

    return img

# ---------- –ú–ï–ù–Æ –ò –°–¢–ê–†–¢ ----------
@bot.message_handler(commands=['start'])
def send_welcome(message):
    markup = types.InlineKeyboardMarkup()
    for years in [70, 80, 90]:
        markup.add(types.InlineKeyboardButton(f"{years} –ª–µ—Ç", callback_data=f"years_{years}"))
    bot.send_message(
        message.chat.id,
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–≤–æ—è –∂–∏–∑–Ω—å –ø–æ –Ω–µ–¥–µ–ª—è–º.\n\n"
        "–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—É—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏:",
        reply_markup=markup
    )

# ---------- –£–°–¢–ê–ù–û–í–ö–ê –ü–†–û–î–û–õ–ñ–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ñ–ò–ó–ù–ò ----------
@bot.callback_query_handler(func=lambda call: call.data.startswith("years_"))
def set_life_expectancy(call):
    years = int(call.data.split("_")[1])
    user_id = str(call.from_user.id)
    if user_id not in users:
        users[user_id] = {}
    users[user_id]["life_expectancy"] = years
    save_users(users)
    bot.answer_callback_query(call.id, f"–í—ã–±—Ä–∞–Ω–æ: {years} –ª–µ—Ç")
    bot.send_message(call.message.chat.id, "–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –î–î.MM.–ì–ì–ì–ì")

# ---------- –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–ê–¢–´ ----------
@bot.message_handler(commands=['change_date'])
def change_birth_date_command(message):
    user_id = str(message.from_user.id)
    awaiting_birth_date_change.add(user_id)
    bot.send_message(message.chat.id, "–û—Ç–ø—Ä–∞–≤—å –Ω–æ–≤—É—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: –î–î.MM.–ì–ì–ì–ì")

# ---------- –û–ë–†–ê–ë–û–¢–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ----------
@bot.message_handler(func=lambda message: True)
def handle_message(message):
    user_id = str(message.from_user.id)

    if user_id in awaiting_birth_date_change:
        try:
            new_birth_date = datetime.strptime(message.text, "%d.%m.%Y").date()
            if user_id not in users:
                users[user_id] = {}
            users[user_id]["birth_date"] = new_birth_date.isoformat()
            save_users(users)
            awaiting_birth_date_change.remove(user_id)
            bot.send_message(message.chat.id, f"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: {message.text}")

            years = users[user_id].get("life_expectancy", 80)
            img = generate_life_weeks_image(new_birth_date, date.today(), years)
            img.save("life.png")
            with open("life.png", "rb") as photo:
                bot.send_photo(message.chat.id, photo, caption=f"–í–æ—Ç —Ç–≤–æ—è –∂–∏–∑–Ω—å –≤ –Ω–µ–¥–µ–ª—è—Ö (—Ä–∞—Å—á—ë—Ç –¥–æ {years} –ª–µ—Ç) üï∞")
        except ValueError:
            bot.reply_to(message, "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.MM.–ì–ì–ì–ì")
    else:
        try:
            birth_date = datetime.strptime(message.text, "%d.%m.%Y").date()
            years = users.get(user_id, {}).get("life_expectancy", 80)
            if user_id not in users:
                users[user_id] = {}
            users[user_id]["birth_date"] = birth_date.isoformat()
            save_users(users)

            img = generate_life_weeks_image(birth_date, date.today(), years)
            img.save("life.png")
            quote = random.choice(quotes)
            with open("life.png", "rb") as photo:
                bot.send_photo(
                    message.chat.id,
                    photo,
                    caption=f"{quote}\n\n–í–æ—Ç —Ç–≤–æ—è –∂–∏–∑–Ω—å –≤ –Ω–µ–¥–µ–ª—è—Ö (—Ä–∞—Å—á—ë—Ç –¥–æ {years} –ª–µ—Ç) üï∞"
                )
        except ValueError:
            bot.reply_to(message, "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.MM.–ì–ì–ì–ì")

# ---------- –ü–õ–ê–ù–ò–†–û–í–©–ò–ö ----------
def send_weekly_updates():
    today = date.today()
    print("üîî –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞", datetime.now())
    for user_id, info in users.items():
        try:
            if "birth_date" in info:
                birth_date = date.fromisoformat(info["birth_date"])
                years = info.get("life_expectancy", 80)
                img = generate_life_weeks_image(birth_date, today, years)
                img.save("life.png")
                quote = random.choice(quotes)
                try:
                    with open("life.png", "rb") as photo:
                        bot.send_photo(
                            user_id,
                            photo,
                            caption=f"{quote}\n\n–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ {today.strftime('%d.%m.%Y')} ‚ú®"
                        )
                except Exception as e:
                    print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å {user_id}: {e}")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–ª—è {user_id}: {e}")

scheduler = BackgroundScheduler()
scheduler.add_job(send_weekly_updates, 'cron', day_of_week='mon', hour=10, minute=0)
scheduler.start()

# ---------- FLASK ----------
app = Flask(__name__)

@app.route('/', methods=['GET'])
def home():
    return "‚úÖ Bot is running and Flask server is alive!"

@app.route(f'/{BOT_TOKEN}', methods=['POST'])
def webhook():
    update = telebot.types.Update.de_json(request.get_data().decode('utf-8'))
    bot.process_new_updates([update])
    return '', 200

if __name__ == "__main__":
    WEBHOOK_URL = f"https://lifetimerbot.onrender.com/{BOT_TOKEN}"
    bot.remove_webhook()
    bot.set_webhook(url=WEBHOOK_URL)

    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port)
